{% extends "layout.html" %}
{% block title %}Observation Map{% endblock %}
{% block head %}
<!-- <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script> -->
<link rel="stylesheet" href="{{ url_for('static', filename='js/leaflet/leaflet.css') }}" />
<link rel="stylesheet" href="{{ url_for('static', filename='css/map.css') }}" />
{% endblock %}

{% block header %}
{% endblock %}

{% block content %}

<div id="map"></div>

<script src="{{ url_for('static', filename='js/leaflet/leaflet.js') }}"></script>
<script src="{{ url_for('static', filename='js/map.js') }}"></script>
<script>
    let map = L.map('map')
        // default to San Antonio, TX
        .setView([29.424, -98.491], 9);

    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);


    window.onload = async () => {
        setMapViewToUserLocation()

        let events = await getEventLocations()
        if (events.meta.total_results > 0)
            addEventMarkers(events.records)

        let palmObservations = await getPalmObservations()
        if (palmObservations.meta.total_results > 0)
            addPalmObservationMarkers(palmObservations.records)

        let cycadObservations = await getCycadObservations()
        if (cycadObservations.meta.total_results > 0)
            addCycadObservationMarkers(cycadObservations.records)
    }
</script>

{% endblock %}